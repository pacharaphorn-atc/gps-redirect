<!DOCTYPE html>
<html>
<head>
  <title>กำลังดึงตำแหน่ง...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <p id="message">กำลังโหลดตำแหน่งของคุณ กรุณารอสักครู่...</p>

  <script>
    const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSen0WiskZGdwrVbxaomauj_E0KzEcRQll_ItvFxPp54Tk0FIQ/viewform";
    const entryId = "entry.1974648496"; // << เปลี่ยนเฉพาะเลขนี้ถ้าไม่ใช่ช่องพิกัด

    navigator.geolocation.getCurrentPosition(function(pos) {
      const lat = pos.coords.latitude.toFixed(6);
      const lng = pos.coords.longitude.toFixed(6);
      const locationString = `${lat},${lng}`;
      const redirectUrl = `${formUrl}?usp=pp_url&${entryId}=${encodeURIComponent(locationString)}`;
      window.location.href = redirectUrl;
    }, function(error) {
      let errorMessage = "ไม่สามารถดึงตำแหน่งได้";

      switch(error.code) {
        case error.PERMISSION_DENIED:
          errorMessage = "ผู้ใช้ปฏิเสธการเข้าถึงตำแหน่ง";
          break;
        case error.POSITION_UNAVAILABLE:
          errorMessage = "ข้อมูลตำแหน่งไม่พร้อมใช้งาน";
          break;
        case error.TIMEOUT:
          errorMessage = "หมดเวลาในการดึงตำแหน่ง";
          break;
        case error.UNKNOWN_ERROR:
          errorMessage = "เกิดข้อผิดพลาดที่ไม่รู้จัก";
          break;
      }

      document.getElementById("message").innerText = errorMessage;

      const fallbackUrl = `${formUrl}?usp=pp_url&${entryId}=${encodeURIComponent(errorMessage)}`;
      window.location.href = fallbackUrl;
    });
  </script>
</body>
</html>